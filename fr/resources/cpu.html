
<!DOCTYPE html>


<html lang="fr" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Cœurs CPU &#8212; CIP201</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=72dce1d2"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/translations.js?v=e6b791cb"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'resources/cpu';</script>
    <link rel="icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Se connecter aux nœuds de calcul" href="../monitoring/compute-nodes.html" />
    <link rel="prev" title="Mémoire" href="memory.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Passer au contenu principal</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Haut de page</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Alerte de version"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt=""/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Tâches de calcul : Ressources et suivi (CIP201)</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Recherche</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">L’ordonnanceur de tâches</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../slurm/intro.html">Généralités</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slurm/commands.html">Commandes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slurm/scripts.html">Scripts de tâches</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Types de tâches de calcul</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../task-types/serial.html">Tâches sérielles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task-types/parallel.html">Tâches parallèles</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Estimer les ressources requises</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="time.html">Temps</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Mémoire</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Cœurs CPU</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Suivi des tâches</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../monitoring/compute-nodes.html">Se connecter aux nœuds de calcul</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring/interactive-sessions.html">Sessions interactives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring/user-portal.html">Portails des utilisateurs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Liens externes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://docs.alliancecan.ca/wiki/Technical_documentation/fr">Documentation technique de l’Alliance</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.calculquebec.ca/services-aux-chercheurs/formation/">Formations de Calcul Québec</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/resources/cpu.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Thème" data-bs-title="Thème"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Clair"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Sombre"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="Paramètres système"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Cœurs CPU</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pourquoi-verifier-lutilisation-du-cpu">Pourquoi vérifier l’utilisation du CPU ?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verifier-lutilisation-du-cpu">Vérifier l’utilisation du CPU</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice">Exercice</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pourquoi-optimiser-le-nombre-de-coeurs-cpu">Pourquoi optimiser le nombre de cœurs CPU ?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scalabilite">Scalabilité</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scalability-exercise">Exercice</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pourquoi-lefficacite-nest-elle-pas-lineaire">Pourquoi l’efficacité n’est-elle pas linéaire ?</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="coeurs-cpu">
<h1>Cœurs CPU<a class="headerlink" href="#coeurs-cpu" title="Lien vers cette rubrique">#</a></h1>
<p><a class="reference external" href="../../en/resources/cpu.html">English</a></p>
<p>Les cœurs CPU sont une ressource analysée diféremment du temps ou de la mémoire.
Pour les tâches parallèles, il faut bien sûr choisir un nombre de cœurs.
Toutefois, aussi bien pour les tâches sérielles que parallèles, il importe de
vérifier que le CPU est bien utilisé.</p>
<section id="pourquoi-verifier-lutilisation-du-cpu">
<h2>Pourquoi vérifier l’utilisation du CPU ?<a class="headerlink" href="#pourquoi-verifier-lutilisation-du-cpu" title="Lien vers cette rubrique">#</a></h2>
<ul class="simple">
<li><p>Les cœurs CPU alloués à une tâche ne sont pas constamment en train de
calculer : ils attendent parfois d’obtenir les données d’un fichier, une
réponse à une communication réseau, etc.</p></li>
<li><p>Si ce temps d’attente est important, les cœurs CPU sont sous-utilisés.</p></li>
<li><p>Régler ce problème accélère votre programme et évite le gaspillage de
ressources, augmentant la priorité de vos tâches.</p></li>
</ul>
</section>
<section id="verifier-lutilisation-du-cpu">
<h2>Vérifier l’utilisation du CPU<a class="headerlink" href="#verifier-lutilisation-du-cpu" title="Lien vers cette rubrique">#</a></h2>
<p>L’utilisation CPU d’une tâche terminée peut être affichée avec <code class="docutils literal notranslate"><span class="pre">seff</span></code>. Par
exemple :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">[alice@narval3 ~]$ </span>seff<span class="w"> </span><span class="m">39732872</span>
</span><span class="go">Job ID: 39732872</span>
<span class="go">Cluster: narval</span>
<span class="go">User/Group: alice/alice</span>
<span class="go">State: COMPLETED (exit code 0)</span>
<span class="hll"><span class="go">Nodes: 1</span>
</span><span class="hll"><span class="go">Cores per node: 12</span>
</span><span class="hll"><span class="go">CPU Utilized: 00:51:04</span>
</span><span class="hll"><span class="go">CPU Efficiency: 70.71% of 01:13:24 core-walltime</span>
</span><span class="hll"><span class="go">Job Wall-clock time: 00:06:07</span>
</span><span class="go">Memory Utilized: 270.59 MB</span>
<span class="go">Memory Efficiency: 8.81% of 3.00 GB</span>
</pre></div>
</div>
<p>Où <em>CPU Utilized</em> est le temps CPU total utilisé par tous les cœurs et <em>Job
Wall-clock time</em> le temps réel. L’utilisation CPU de cette tâche est de 70,71 %.
Cela signifie que près de 30 % du temps CPU potentiel a été inutilisé ! <code class="docutils literal notranslate"><span class="pre">seff</span></code>
calcule l’utilisation (<span class="math notranslate nohighlight">\(U\)</span>) pour <span class="math notranslate nohighlight">\(n\)</span> cœurs CPU ainsi :</p>
<div class="math notranslate nohighlight">
\[U = \frac{t_\text{CPU}}{t_\text{réel}\;n}\]</div>
<p>Les valeurs brutes nécessaires à ce calcul peuvent aussi être affichés
avec <code class="docutils literal notranslate"><span class="pre">sacct</span></code>. Par exemple :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="gp">[alice@narval3 ~]$ </span>sacct<span class="w"> </span>-j<span class="w"> </span><span class="m">39732872</span><span class="w"> </span>-o<span class="w"> </span>JobID%15,JobName,Elapsed,TotalCPU,NCPUs
</span><span class="go">          JobID    JobName    Elapsed   TotalCPU      NCPUS</span>
<span class="go">--------------- ---------- ---------- ---------- ----------</span>
<span class="hll"><span class="go">       39732872     gmx-md   00:06:07  51:04.301         12</span>
</span><span class="go"> 39732872.batch      batch   00:06:07  00:01.043         12</span>
<span class="go">39732872.extern     extern   00:06:07  00:00.001         12</span>
<span class="go">     39732872.0        gmx   00:06:05  51:03.255         12</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Les caractères <code class="docutils literal notranslate"><span class="pre">%15</span></code> sont utilisés pour contrôler la largeur de la
colonne.</p>
</div>
<p>Si l’utilisation CPU est inférieure à 90 %, il convient de se poser des
questions. Votre programme passe-t-il beaucoup de temps à lire des fichiers
plutôt qu’à calculer ? Y a-t-il une communication inefficace entre les cœurs CPU
alloués à une tâche parallèle ? Pour le vérifier :</p>
<ul class="simple">
<li><p>Réduisez le nombre de cœurs CPU s’il s’agit d’une tâche parallèle.</p></li>
<li><p>Optimisez les accès au stockage en lisant les fichiers à partir du <a class="reference external" href="https://docs.alliancecan.ca/wiki/Using_node-local_storage/fr">stockage
local sur les nœuds de calcul</a> plutôt qu’à
partir d’un système de fichiers réseau (<code class="docutils literal notranslate"><span class="pre">/home</span></code>, <code class="docutils literal notranslate"><span class="pre">/project</span></code>,
<code class="docutils literal notranslate"><span class="pre">/scratch</span></code>). Vos tâches ont accès à un répertoire temporaire local dans
<code class="docutils literal notranslate"><span class="pre">$SLURM_TMPDIR</span></code>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Dans la sortie de <code class="docutils literal notranslate"><span class="pre">seff</span></code>, l’utilisation CPU est appelée <em>CPU Efficiency</em>.
Toutefois, cette mesure est distincte de l’<em>efficacité</em> d’un programme
parallèle, qui est une mesure de sa <a class="reference internal" href="#scalability"><span class="std std-ref">scalabilité</span></a>, tel
que discuté dans les sections suivantes.</p>
</div>
<section id="exercice">
<h3>Exercice<a class="headerlink" href="#exercice" title="Lien vers cette rubrique">#</a></h3>
<ol class="arabic simple">
<li><p>Affichez la liste de vos tâches avec <code class="docutils literal notranslate"><span class="pre">sacct</span> <span class="pre">-X</span></code>.</p></li>
<li><p>Essayez la commande <code class="docutils literal notranslate"><span class="pre">seff</span> <span class="pre">&lt;jobid&gt;</span></code> pour l’une d’entre elles et vérifiez
l’utilisation CPU.</p></li>
<li><p>Essayez <code class="docutils literal notranslate"><span class="pre">sacct</span> <span class="pre">-j</span> <span class="pre">&lt;jobid&gt;</span> <span class="pre">-o</span> <span class="pre">JobID,JobName,Elapsed,TotalCPU,NCPUs</span></code> pour la
même tâche. Calculez l’utilisation CPU.</p></li>
</ol>
</section>
</section>
<section id="pourquoi-optimiser-le-nombre-de-coeurs-cpu">
<h2>Pourquoi optimiser le nombre de cœurs CPU ?<a class="headerlink" href="#pourquoi-optimiser-le-nombre-de-coeurs-cpu" title="Lien vers cette rubrique">#</a></h2>
<ul class="simple">
<li><p>Votre programme parallèle se terminera plus rapidement si plus de cœurs CPU
sont alloués à la tâche.</p></li>
<li><p>La performance d’un programme n’augmente toutefois pas indéfiniment avec le
nombre de cœurs.</p></li>
<li><p>En outre, les tâches qui demandent plus de cœurs attentent davantage dans la
file et consomment plus de ressources, diminuant la priorité de vos tâches.</p></li>
<li><p>Un nombre optimal de cœurs CPU balance ces effets opposés, minimisant le temps
total (attente et calcul) pour accomplir vos tâches et évitant le gaspillage
de ressources.</p></li>
</ul>
</section>
<section id="scalabilite">
<span id="scalability"></span><h2>Scalabilité<a class="headerlink" href="#scalabilite" title="Lien vers cette rubrique">#</a></h2>
<p>La <a class="reference external" href="https://docs.alliancecan.ca/wiki/Scalability/fr">scalabilité</a> est la
capacité d’un programme parallèle à réduire le temps de calcul à mesure qu’il
utilise plus de cœurs CPU. Par exemple, idéalement, utiliser deux cœurs CPU
plutôt qu’un seul réduirait de moitié le temps de calcul et en utiliser quatre
réduirait ce temps à 1/4 du temps requis avec un seul cœur.</p>
<p>En réalité, toutefois, les programmes parallèles ont leurs limites. À mesure que
l’on utilise plus de cœurs CPU, le gain de temps diminue et devient
éventuellement négligeable. Certains programmes et algorithmes ont une meilleure
scalabilité que d’autres. De plus, la scalabilité varie en fonction de certains
paramètres tels que la taille des données d’entrée.</p>
<p>On quantifie la scalabilité avec deux grandeurs : l’accélération et
l’efficacité. Pour <span class="math notranslate nohighlight">\(n\)</span> cœurs CPU, l’accélération (<em>speedup</em>, <span class="math notranslate nohighlight">\(S\)</span>)
est le ratio du temps d’exécution sériel sur le temps d’exécution parallèle :</p>
<div class="math notranslate nohighlight">
\[S_n = \frac{t_\text{sériel}}{t_n}\]</div>
<p>Par exemple, si un calcul requiert 10 minutes avec 1 cœur CPU et 6 minutes avec
2, l’accélaration est de 1,67. C’est donc une mesure de « combien de fois plus
rapide est le programme ».</p>
<p>L’efficacité (<em>efficiency</em>, <span class="math notranslate nohighlight">\(E\)</span>) est le ratio de l’accélération sur le
nombre de cœurs CPU :</p>
<div class="math notranslate nohighlight">
\[E_n = \frac{S_n}{n}\]</div>
<p>Poursuivant l’exemple ci-dessus, une accélération de 1,67 pour 2 cœurs CPU donne
une efficacité de 0,835 (83,5 %). Une efficacité de 100 % est qualifiée de
linéaire. Lorsque l’efficacité tombe sous 75 %, on devrait généralement diminuer
le nombre de cœurs utilisés.</p>
<p>Dans cet exemple de scalabilité d’un programme parallèle (voir figure
ci-dessous), on remarque un point d’inflection à 256 cœurs : l’efficacité
diminue rapidement passé ce point.</p>
<figure class="align-default">
<img alt="../_images/gmx-scaling_fr.svg" src="../_images/gmx-scaling_fr.svg" />
</figure>
<p>Dans cet exemple, on utilise la performance (<span class="math notranslate nohighlight">\(P\)</span>) plutôt que le temps de
calcul (<span class="math notranslate nohighlight">\(t\)</span>) pour illustrer la scalabilité. Les deux approches sont
équivalentes, la performance ayant simplement une dimension inverse
(<span class="math notranslate nohighlight">\(t^{-1}\)</span>). La performance est exprimée dans une unité qui sied au
problème : étapes de calcul par seconde, nombre d’images ou de molécules
traitées par heure, durée de trajectoire simulée par jour, etc. L’accélération
peut être calculée à partir de la performance plutôt que du temps de calcul :</p>
<div class="math notranslate nohighlight">
\[S_n = \frac{P_{n}}{P_\text{sérielle}}\]</div>
<section id="scalability-exercise">
<span id="id1"></span><h3>Exercice<a class="headerlink" href="#scalability-exercise" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Objectifs</strong></p>
<ul class="simple">
<li><p>Analyser la scalabilité d’une tâche parallèle.</p></li>
<li><p>Déterminer le nombre optimal de cœurs CPU à utiliser pour cette tâche.</p></li>
</ul>
<p><strong>Instructions</strong></p>
<ol class="arabic simple">
<li><p>Allez dans le répertoire de l’exercice avec <code class="docutils literal notranslate"><span class="pre">cd</span>
<span class="pre">~/cq-formation-cip201-main/lab/gmx-scaling</span></code>.</p></li>
<li><p>Préparer les fichiers d’entrée de la tâche avec <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">gmx-prepare.sh</span></code>.</p></li>
<li><p>Éditez le script de tâche avec <code class="docutils literal notranslate"><span class="pre">nano</span> <span class="pre">gmx-job.sh</span></code>. Demandez 1, 2, 4 ou 8
cœurs CPU avec l’option <code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code>.</p></li>
<li><p>Soumettez la tâche.</p></li>
<li><p>Une fois la tâche terminée, obtenez la performance du programme avec <code class="docutils literal notranslate"><span class="pre">grep</span>
<span class="pre">^Performance</span> <span class="pre">slurm-&lt;jobid&gt;.out</span></code>.</p>
<ul class="simple">
<li><p>Notez la première des deux valeurs obtenues et inscrivez-la dans
<code class="docutils literal notranslate"><span class="pre">gmx-scaling.txt</span></code> dans la colonne <span class="math notranslate nohighlight">\(P\)</span> (ns/day) sur la ligne où
la valeur de <span class="math notranslate nohighlight">\(n\)</span> correspond au nombre de cœurs CPU utilisés.</p></li>
</ul>
</li>
<li><p>Changez le nombre de cœurs demandés et répétez la tâche. (Ne préparez pas à
nouveau les fichiers d’entrée.)</p></li>
<li><p>Remplissez et analysez le reste du tableau dans <code class="docutils literal notranslate"><span class="pre">gmx-scaling.txt</span></code>.</p>
<ol class="arabic simple">
<li><p>Calculez l’accélération <span class="math notranslate nohighlight">\(S\)</span> et l’efficacité <span class="math notranslate nohighlight">\(E\)</span> (%) pour 2, 4
et 8 cœurs.</p></li>
<li><p>Combien de cœurs CPU utiliseriez-vous pour des tâches similaires ?</p></li>
</ol>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Cette tâche calcule les interactions au sein d’une boîte périodique
contenant 216 molécules d’eau (648 atomes, voir figure ci-dessous) avec
GROMACS, un logiciel pour les simulations biomoléculaires.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/water-box.png"><img alt="../_images/water-box.png" src="../_images/water-box.png" style="width: 320px;" />
</a>
</figure>
<p>Les auteurs du programme rapportent qu’il est scalable jusqu’à environ 50
atomes par cœur CPU. En deçà de cette valeur, la performance n’augmente plus
même si l’on utilise davantage de cœurs. L’efficacité diminue toutefois bien
avant d’atteindre cette limite !</p>
<p>En pratique, les simulations biomoléculaires traitent des systèmes beaucoup
plus gros, souvent de l’ordre de centaines de milliers d’atomes. Les
programmes parallèles qui simulent ces systèmes sont efficaces même avec des
centaines de cœurs CPU.</p>
</div>
</section>
<section id="pourquoi-lefficacite-nest-elle-pas-lineaire">
<h3>Pourquoi l’efficacité n’est-elle pas linéaire ?<a class="headerlink" href="#pourquoi-lefficacite-nest-elle-pas-lineaire" title="Lien vers cette rubrique">#</a></h3>
<p>La scalabilité est limitée par la fraction du programme qui calcule en parallèle
(voir figure ci-dessous). C’est ce qu’on appelle la <a class="reference external" href="https://fr.wikipedia.org/wiki/Loi_d%27Amdahl">loi d’Amdahl</a>. Un programme parallèle peut
avoir une fraction sérielle pour une variété de raisons :</p>
<ul class="simple">
<li><p>Lecture non parallèle d’un fichier d’entrée ou mise à jour d’un fichier de
sortie.</p></li>
<li><p>Pré- ou post-traitement des données avant ou après l’application d’un
algorithme parallèle.</p></li>
<li><p>Une étape intermédiaire du calcul qui n’est pas parallélisée.</p></li>
</ul>
<figure class="align-default">
<img alt="../_images/serial-vs-parallel_fr.svg" src="../_images/serial-vs-parallel_fr.svg" />
</figure>
<p>De plus, le temps nécessaire à la communication entre les fils d’exécution
diminue l’efficacité. Généralement, plus la taille d’un problème augmente, plus
son traitement parallèle est efficace.</p>
<p>Pour toutes ces raisons, la seule manière de déterminer efficacement le nombre
optimal de CPU pour une tâche parallèle est de faire une analyse de scalabilité
(voir l’<a class="reference internal" href="#scalability-exercise"><span class="std std-ref">exercice</span></a> ci-haut) et de la répéter chaque
fois que les paramètres de votre tâche ou la taille de vos données d’entrée
changent significativement.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On distingue la scalabilité forte (<em>strong scaling</em>) de la
scalabilité faible (<em>week scaling</em>).</p>
<ul class="simple">
<li><p>La scalabilité forte est la variation du temps de calcul en fonction du
nombre de cœurs CPU pour un problème dont la taille <em>totale</em> est
constante. Idéalement, le temps de calcul est inversement proportionnel au
nombre de cœurs CPU.</p></li>
<li><p>La scalabilité faible est la variation du temps de calcul en fonction du
nombre de cœurs CPU pour un problème dont la taille <em>par cœur CPU</em> est
constante. Idéalement, le temps de calcul demeure constant.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>À nouveau, l’<em>efficacité</em> d’un programme parallèle n’est pas la même mesure
que son utilisation du CPU. La mesure dénommée <em>CPU Efficiency</em> dans la
sortie de la commande <code class="docutils literal notranslate"><span class="pre">seff</span></code> est en fait l’utilisation CPU et n’est pas
une mesure de la scalabilité d’un programme : <code class="docutils literal notranslate"><span class="pre">seff</span></code> ne peut pas deviner
et analyser automatiquement la performance d’un programme parallèle !</p>
</div>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="memory.html"
       title="page précédente">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title">Mémoire</p>
      </div>
    </a>
    <a class="right-next"
       href="../monitoring/compute-nodes.html"
       title="page suivante">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">suivant</p>
        <p class="prev-next-title">Se connecter aux nœuds de calcul</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pourquoi-verifier-lutilisation-du-cpu">Pourquoi vérifier l’utilisation du CPU ?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#verifier-lutilisation-du-cpu">Vérifier l’utilisation du CPU</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice">Exercice</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pourquoi-optimiser-le-nombre-de-coeurs-cpu">Pourquoi optimiser le nombre de cœurs CPU ?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scalabilite">Scalabilité</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scalability-exercise">Exercice</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pourquoi-lefficacite-nest-elle-pas-lineaire">Pourquoi l’efficacité n’est-elle pas linéaire ?</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par Calcul Québec
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Calcul Québec.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>